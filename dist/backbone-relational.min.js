(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var o in i)e.o(i,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:i[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=_;var i=e.n(t);const o=Backbone;var n=e.n(o);const s={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}};var l=function(){this._queue=[]};_.extend(l.prototype,s,{_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;for(this._queue=[];e&&e.length;)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}});const r=l;var a=function(e,t,i){if(this.instance=e,t=_.isObject(t)?t:{},this.reverseRelation=_.defaults(t.reverseRelation||{},this.options.reverseRelation),this.options=_.defaults(t,this.options,a.prototype.options),this.reverseRelation.type=_.isString(this.reverseRelation.type)?n()[this.reverseRelation.type]||C.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,_.isUndefined(this.relatedModel)&&(this.relatedModel=this.model),!_.isFunction(this.relatedModel)||this.relatedModel.prototype instanceof n().RelationalModel||(this.relatedModel=_.result(this,"relatedModel")),_.isString(this.relatedModel)&&(this.relatedModel=C.store.getObjectByName(this.relatedModel)),this.checkPreconditions()&&(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&C.store.addReverseRelation(_.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation)),e)){var o=this.keySource;o!==this.key&&_.isObject(this.instance.get(this.key))&&(o=this.key),this.setKeyContents(this.instance.get(o)),this.relatedCollection=C.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(i),this.options.autoFetch&&this.instance.getAsync(this.key,_.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}};a.extend=n().Model.extend,_.extend(a.prototype,n().Events,s,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,t=this.key,i=this.model,o=this.relatedModel,s=C.showWarnings&&"undefined"!=typeof console;if(!i||!t||!o)return s&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,i,t,o),!1;if(!(i.prototype instanceof n().RelationalModel))return s&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1;if(!(o.prototype instanceof n().RelationalModel))return s&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,o),!1;if(this instanceof n().HasMany&&this.reverseRelation.type===n().HasMany)return s&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&_.keys(e._relations).length){var l=_.find(e._relations,(function(e){return e.key===t}),this);if(l)return s&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,t,e,l),!1}return!0},setRelated:function(e){this.related=e,this.instance.attributes[this.key]=e},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key},getReverseRelations:function(e){for(var t=[],i=_.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e],o=null,n=null,s=0;s<(i||[]).length;s++){o=i[s].getRelations()||[];for(var l=0;l<o.length;l++)n=o[l],this._isReverseRelation(n)&&t.push(n)}return t},destroy:function(){this.stopListening(),this instanceof n().HasOne?this.setRelated(null):this instanceof n().HasMany&&this.setRelated(this._prepareCollection()),_.each(this.getReverseRelations(),(function(e){e.removeRelated(this.instance)}),this)}}),a.extend=n().Model.extend;const c=a,h=c.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var t=this.findRelated(e);this.setRelated(t),_.each(this.getReverseRelations(),(function(t){t.addRelated(this.instance,e)}),this)},findRelated:function(e){var t=null;if(e=_.defaults({parse:this.options.parse},e),this.keyContents instanceof this.relatedModel)t=this.keyContents;else if(this.keyContents||0===this.keyContents){var i=_.defaults({create:this.options.createModels},e);t=this.relatedModel.findOrCreate(this.keyContents,i)}return t&&(this.keyId=null),t},setKeyContents:function(e){this.keyContents=e,this.keyId=C.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,t,i){if(!this.isLocked()){this.acquire(),i=i?_.clone(i):{};var o=_.isUndefined(i.__related),n=o?this.related:i.__related;if(o){this.setKeyContents(t);var s=this.findRelated(i);this.setRelated(s)}if(n&&this.related!==n&&_.each(this.getReverseRelations(n),(function(e){e.removeRelated(this.instance,null,i)}),this),_.each(this.getReverseRelations(),(function(e){e.addRelated(this.instance,i)}),this),!i.silent&&this.related!==n){var l=this;this.changed=!0,C.eventQueue.add((function(){l.instance.trigger("change:"+l.key,l.instance,l.related,i,!0),l.changed=!1}))}this.release()}},tryAddRelated:function(e,t,i){!this.keyId&&0!==this.keyId||e.id!==this.keyId||(this.addRelated(e,i),this.keyId=null)},addRelated:function(e,t){var i=this;e.queue((function(){if(e!==i.related){var o=i.related||null;i.setRelated(e),i.onChange(i.instance,e,_.defaults({__related:o},t))}}))},removeRelated:function(e,t,i){if(this.related&&e===this.related){var o=this.related||null;this.setRelated(null),this.onChange(this.instance,e,_.defaults({__related:o},i))}}}),d=c.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:n().Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){if(this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,!_.isFunction(this.collectionType)||this.collectionType===n().Collection||this.collectionType.prototype instanceof n().Collection||(this.collectionType=_.result(this,"collectionType")),_.isString(this.collectionType)&&(this.collectionType=C.store.getObjectByName(this.collectionType)),this.collectionType!==n().Collection&&!(this.collectionType.prototype instanceof n().Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var t=this.findRelated(e);this.setRelated(t)},_prepareCollection:function(e){if(this.related&&this.stopListening(this.related),!(e&&e instanceof n().Collection)){var t=_.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,t)}if(e.model=this.relatedModel,this.options.collectionKey){var i=!0===this.options.collectionKey?this.options.reverseRelation.key:this.options.collectionKey;e[i]&&e[i]!==this.instance?n().Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,i,this.options.collectionKey):i&&(e[i]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var t=null;if(e=_.defaults({parse:this.options.parse},e),this.keyContents instanceof n().Collection)this._prepareCollection(this.keyContents),t=this.keyContents;else{var i=[];_.each(this.keyContents,(function(t){var o;(o=t instanceof this.relatedModel?t:_.isObject(t)&&e.parse&&this.relatedModel.prototype.parse?this.relatedModel.prototype.parse(_.clone(t),e):t)&&i.push(o)}),this),(t=this.related instanceof n().Collection?this.related:this._prepareCollection()).set(i,_.defaults({parse:!1},e))}return this.keyIds=_.difference(this.keyIds,_.pluck(t.models,"id")),t},setKeyContents:function(e){this.keyContents=e instanceof n().Collection?e:null,this.keyIds=[],this.keyContents||!e&&0!==e||(this.keyContents=_.isArray(e)?e:[e],_.each(this.keyContents,(function(e){var t=C.store.resolveIdForItem(this.relatedModel,e);(t||0===t)&&this.keyIds.push(t)}),this))},onChange:function(e,t,i){i=i?_.clone(i):{},this.setKeyContents(t),this.changed=!1;var o=this.findRelated(i);if(this.setRelated(o),!i.silent){var n=this;C.eventQueue.add((function(){n.changed&&(n.instance.trigger("change:"+n.key,n.instance,n.related,i,!0),n.changed=!1)}))}},handleAddition:function(e,t,i){i=i?_.clone(i):{},this.changed=!0,_.each(this.getReverseRelations(e),(function(e){e.addRelated(this.instance,i)}),this);var o=this;!i.silent&&C.eventQueue.add((function(){o.instance.trigger("add:"+o.key,e,o.related,i)}))},handleRemoval:function(e,t,i){i=i?_.clone(i):{},this.changed=!0,_.each(this.getReverseRelations(e),(function(e){e.removeRelated(this.instance,null,i)}),this);var o=this;!i.silent&&C.eventQueue.add((function(){o.instance.trigger("remove:"+o.key,e,o.related,i)}))},handleReset:function(e,t){var i=this;!(t=t?_.clone(t):{}).silent&&C.eventQueue.add((function(){i.instance.trigger("reset:"+i.key,i.related,t)}))},tryAddRelated:function(e,t,i){_.contains(this.keyIds,e.id)&&(this.addRelated(e,i),this.keyIds=_.without(this.keyIds,e.id))},addRelated:function(e,t){var i=this;e.queue((function(){i.related&&!i.related.get(e)&&i.related.add(e,_.defaults({parse:!1},t))}))},removeRelated:function(e,t,i){this.related.get(e)&&this.related.remove(e,i)}});var u=n().Model.extend({relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(e,t){if(t&&t.collection){var i=this,o=this.collection=t.collection;delete t.collection,this._deferProcessing=!0;var s=function(e){e===i&&(i._deferProcessing=!1,i.processQueue(),o.off("relational:add",s))};o.on("relational:add",s),_.defer((function(){s(i)}))}C.store.processOrphanRelations(),C.store.listenTo(this,"relational:unregister",C.store.unregister),this._queue=new(n().BlockingQueue),this._queue.block(),C.eventQueue.block();try{n().Model.apply(this,arguments)}finally{C.eventQueue.unblock()}},trigger:function(e){if(e.length>5&&0===e.indexOf("change")){var t=this,i=arguments;C.eventQueue.isBlocked()?C.eventQueue.add((function(){var o=!0;if("change"===e)o=t.hasChanged()||t._attributeChangeFired,t._attributeChangeFired=!1;else{var s=e.slice(7),l=t.getRelation(s);l?(o=!0===i[4])?t.changed[s]=i[2]:l.changed||delete t.changed[s]:o&&(t._attributeChangeFired=!0)}o&&n().Model.prototype.trigger.apply(t,i)})):n().Model.prototype.trigger.apply(t,i)}else"destroy"===e?(n().Model.prototype.trigger.apply(this,arguments),C.store.unregister(this)):n().Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(e){this.acquire(),this._relations={},_.each(this.relations||[],(function(t){C.store.initializeRelation(this,t,e)}),this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e,t){this._isInitialized&&!this.isLocked()&&_.each(this._relations,(function(i){if(!e||i.keySource in e||i.key in e){var o=this.attributes[i.keySource]||this.attributes[i.key],n=e&&(e[i.keySource]||e[i.key]);(i.related!==o||null===o&&null===n)&&this.trigger("relational:change:"+i.key,this,o,t||{})}i.keySource!==i.key&&delete this.attributes[i.keySource]}),this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return _.values(this._relations)},getIdsToFetch:function(e,t){var i=e instanceof n().Relation?e:this.getRelation(e),o=i?i.keyIds&&i.keyIds.slice(0)||(i.keyId||0===i.keyId?[i.keyId]:[]):[];if(t){var s=i.related&&(i.related.models||[i.related]);_.each(s,(function(e){(e.id||0===e.id)&&o.push(e.id)}))}return o},getAsync:function(e,t){t=_.extend({add:!0,remove:!1,refresh:!1},t);var i=this,o=[],s=this.getRelation(e),l=s&&this.getIdsToFetch(s,t.refresh),r=s.related instanceof n().Collection?s.related:s.relatedCollection;if(l&&l.length){var a,c=[],h=[],d=function(){c=_.map(l,(function(e){var i=s.relatedModel.findModel(e);if(!i){var o={};o[s.relatedModel.prototype.idAttribute]=e,i=s.relatedModel.findOrCreate(o,t),h.push(i)}return i}),this)};if(r instanceof n().Collection&&_.isFunction(r.url)){var u=r.url();(a=r.url(l))===u&&(d(),(a=r.url(c))===u&&(a=null))}if(a){var p=_.defaults({error:function(){_.each(h,(function(e){e.trigger("destroy",e,e.collection,t)})),t.error&&t.error.apply(c,arguments)},url:a},t);o=[r.fetch(p)]}else c.length||d(),o=_.map(c,(function(e){var i=_.defaults({error:function(){_.contains(h,e)&&e.trigger("destroy",e,e.collection,t),t.error&&t.error.apply(c,arguments)}},t);return e.fetch(i)}),this)}return this.deferArray(o).then((function(){return n().Model.prototype.get.call(i,e)}))},deferArray:function(e){return n().$.when.apply(null,e)},set:function(e,t,i){var o,s;C.eventQueue.block(),_.isObject(e)||null==e?(o=e,i=t):(o={})[e]=t;try{var l=this.id,r=o&&this.idAttribute in o&&o[this.idAttribute];C.store.checkId(this,r),s=n().Model.prototype.set.apply(this,arguments),this._isInitialized||this.isLocked()?r&&r!==l&&C.store.update(this):(this.constructor.initializeModelHierarchy(),(r||0===r)&&C.store.register(this),this.initializeRelations(i)),o&&this.updateRelations(o,i)}finally{C.eventQueue.unblock()}return s},clone:function(){var e=_.clone(this.attributes);return _.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),_.each(this.getRelations(),(function(t){delete e[t.key]})),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var t=n().Model.prototype.toJSON.call(this,e);return this.constructor._superModel&&!(this.constructor._subModelTypeAttribute in t)&&(t[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),_.each(this._relations,(function(i){var o=t[i.key],s=i.options.includeInJSON,l=null;!0===s?o&&_.isFunction(o.toJSON)&&(l=o.toJSON(e)):_.isString(s)?(o instanceof n().Collection?l=o.pluck(s):o instanceof n().Model&&(l=o.get(s)),s===i.relatedModel.prototype.idAttribute&&(i instanceof n().HasMany?l=l.concat(i.keyIds):i instanceof n().HasOne&&((l=l||i.keyId)||_.isObject(i.keyContents)||(l=i.keyContents||null)))):_.isArray(s)?o instanceof n().Collection?(l=[],o.each((function(e){var t={};_.each(s,(function(i){t[i]=e.get(i)})),l.push(t)}))):o instanceof n().Model&&(l={},_.each(s,(function(e){l[e]=o.get(e)}))):delete t[i.key],null===l&&e&&e.wait&&(l=o),s&&(t[i.keyDestination]=l),i.keyDestination!==i.key&&delete t[i.key]})),this.release(),t}},{setup:function(e){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?C.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,_.each(this.prototype.relations||[],(function(e){if(e.model||(e.model=this),e.reverseRelation&&e.model===this){var t=!0;if(_.isString(e.relatedModel)){var i=C.store.getObjectByName(e.relatedModel);t=i&&i.prototype instanceof n().RelationalModel}t?C.store.initializeRelation(null,e):_.isString(e.relatedModel)&&C.store.addOrphanRelation(e)}}),this),this},build:function(e,t){return this.initializeModelHierarchy(),new(this._findSubModelType(this,e)||this)(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var i=t[e.prototype.subModelTypeAttribute],o=e._subModels[i];if(o)return o;for(i in e._subModels)if(o=this._findSubModelType(e._subModels[i],t))return o}return null},initializeModelHierarchy:function(){if(this.inheritRelations(),this.prototype.subModelTypes){var e=_.keys(this._subModels),t=_.omit(this.prototype.subModelTypes,e);_.each(t,(function(e){var t=C.store.getObjectByName(e);t&&t.initializeModelHierarchy()}))}},inheritRelations:function(){if(_.isUndefined(this._superModel)||_.isNull(this._superModel))if(C.store.setupSuperModel(this),this._superModel){if(this._superModel.inheritRelations(),this._superModel.prototype.relations){var e=_.filter(this._superModel.prototype.relations||[],(function(e){return!_.any(this.prototype.relations||[],(function(t){return e.relatedModel===t.relatedModel&&e.key===t.key}),this)}),this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,t){t||(t={});var i=_.isObject(e)&&t.parse&&this.prototype.parse?this.prototype.parse(_.clone(e),t):e,o=this.findModel(i);return _.isObject(e)&&(o&&!1!==t.merge?(delete t.collection,delete t.url,o.set(i,t)):o||!1===t.create||(o=this.build(i,_.defaults({parse:!1},t)))),o},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)},findModel:function(e){return C.store.find(this,e)}});_.extend(u.prototype,s),u.extend=function(e,t){var i=n().Model.extend.apply(this,arguments);return i.setup(this),i};const p=u;n().Collection.prototype.__prepareModel=n().Collection.prototype._prepareModel,n().Collection.prototype._prepareModel=function(e,t){var i;return e instanceof n().Model?(e.collection||(e.collection=this),i=e):((t=t?_.clone(t):{}).collection=this,(i=void 0!==this.model.findOrCreate?this.model.findOrCreate(e,t):new this.model(e,t))&&i.validationError&&(this.trigger("invalid",this,e,t),i=!1)),i};var f=n().Collection.prototype.__set=n().Collection.prototype.set;n().Collection.prototype.set=function(e,t){if(!(this.model.prototype instanceof p))return f.call(this,e,t);t&&t.parse&&(e=this.parse(e,t));var i=!_.isArray(e),o=[],s=[],l=null;e=i?e?[e]:[]:_.clone(e);for(var r=0;r<e.length;r++)(l=e[r])instanceof n().Model||(l=n().Collection.prototype._prepareModel.call(this,l,t)),l&&(s.push(l),this.get(l)||this.get(l.cid)?null!==l.id&&void 0!==l.id&&(this._byId[l.id]=l):o.push(l));s=i?s.length?s[0]:null:s;var a=f.call(this,s,_.defaults({merge:!1,parse:!1},t));for(r=0;r<o.length;r++)l=o[r],(this.get(l)||this.get(l.cid))&&this.trigger("relational:add",l,this,t);return a};var y=n().Collection.prototype.___removeModels=n().Collection.prototype._removeModels;n().Collection.prototype._removeModels=function(e,t){if(!(this.model.prototype instanceof p))return y.call(this,e,t);var i=[];_.each(e,(function(e){(e=this.get(e)||e&&this.get(e.cid))&&i.push(e)}),this);var o=y.call(this,i,t);return _.each(i,(function(e){this.trigger("relational:remove",e,this,t)}),this),o};var v=n().Collection.prototype.__reset=n().Collection.prototype.reset;n().Collection.prototype.reset=function(e,t){t=_.extend({merge:!0},t);var i=v.call(this,e,t);return this.model.prototype instanceof p&&this.trigger("relational:reset",this,t),i};var g=n().Collection.prototype.__sort=n().Collection.prototype.sort;n().Collection.prototype.sort=function(e){var t=g.call(this,e);return this.model.prototype instanceof p&&this.trigger("relational:reset",this,e),t};var M=n().Collection.prototype.__trigger=n().Collection.prototype.trigger;n().Collection.prototype.trigger=function(e){if(!(this.model.prototype instanceof p))return M.apply(this,arguments);if("add"===e||"remove"===e||"reset"===e||"sort"===e){var t=this,i=arguments;_.isObject(i[3])&&((i=_.toArray(i))[3]=_.clone(i[3])),n().Relational.eventQueue.add((function(){M.apply(t,i)}))}else M.apply(this,arguments);return this};var R=window,k=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[R]};i().extend(k.prototype,n().Events,{initializeRelation:function(e,t,o){var s=i().isString(t.type)?n()[t.type]||this.getObjectByName(t.type):t.type;s&&s.prototype instanceof n().Relation?new s(e,t,o):n().Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; missing or invalid relation type!",t)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=i().without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){i().find(this._subModels,(function(t){return i().filter(t.subModels||[],(function(i,o){var n=this.getObjectByName(i);if(e===n)return t.superModelType._subModels[o]=e,e._superModel=t.superModelType,e._subModelTypeValue=o,e._subModelTypeAttribute=t.superModelType.prototype.subModelTypeAttribute,!0}),this).length}),this)},addReverseRelation:function(e){!i().any(this._reverseRelations,(function(t){return i().all(e||[],(function(e,i){return e===t[i]}))}))&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){!i().any(this._orphanRelations,(function(t){return i().all(e||[],(function(e,i){return e===t[i]}))}))&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){i().each(this._orphanRelations.slice(0),(function(e){n().Relational.store.getObjectByName(e.relatedModel)&&(this.initializeRelation(null,e),this._orphanRelations=i().without(this._orphanRelations,e))}),this)},_addRelation:function(e,t){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(t),i().each(e._subModels||[],(function(e){this._addRelation(e,t)}),this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each((function(t){t instanceof e.model&&new e.type(t,e)}),this)},getCollection:function(e,t){e instanceof p&&(e=e.constructor);for(var o=e;o._superModel;)o=o._superModel;var n=i().find(this._collections,(function(e){return e.model===o}));return n||!1===t||(n=this._createCollection(o)),n},getObjectByName:function(e){var t=e.split("."),o=null;return i().find(this._modelScopes,(function(e){if((o=i().reduce(t||[],(function(e,t){return e?e[t]:void 0}),e))&&o!==e)return!0}),this),o},_createCollection:function(e){var t;return e instanceof p&&(e=e.constructor),e.prototype instanceof p&&((t=new(n().Collection)).model=e,this._collections.push(t)),t},resolveIdForItem:function(e,t){var o=i().isString(t)||i().isNumber(t)?t:null;return null===o&&(t instanceof p?o=t.id:i().isObject(t)&&(o=t[e.prototype.idAttribute])),o||0===o||(o=null),o},find:function(e,t){var i=this.resolveIdForItem(e,t),o=this.getCollection(e);if(o){var n=o.get(i);if(n instanceof e)return n}return null},register:function(e){var t=this.getCollection(e);if(t){var i=e.collection;t.add(e),e.collection=i}},checkId:function(e,t){var i=this.getCollection(e),o=i&&i.get(t);if(o&&e!==o)throw n().Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",o,e),new Error("Cannot instantiate more than one RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t.contains(e)||this.register(e),t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e){var t,o;e instanceof n().Model?(t=this.getCollection(e),o=[e]):e instanceof n().Collection?(t=this.getCollection(e.model),o=i().clone(e.models)):(t=this.getCollection(e),o=i().clone(t.models)),i().each(o,(function(e){this.stopListening(e),i().invoke(e.getRelations(),"stopListening")}),this),i().contains(this._collections,e)?t.reset([]):i().each(o,(function(e){t.get(e)?t.remove(e):t.trigger("relational:remove",e,t)}),this)},reset:function(){this.stopListening(),i().each(this._collections,(function(e){this.unregister(e)}),this),this._collections=[],this._subModels=[],this._modelScopes=[R]}});const m=k;var b={showWarnings:!0};b.eventQueue=new r,b.store=new m;const C=b;i().any||(i().any=i().some,i().all=i().every,i().contains=i().includes,i().pluck=i().map),n().Semaphore=s,n().BlockingQueue=r,n().Store=m,n().Relational=C,n().Relation=c,n().HasOne=h,n().HasMany=d,n().RelationalModel=p})();